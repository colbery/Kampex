{"version":3,"file":"gallery.js","sources":["../../src/plugins/gallery/constants.js","../../src/plugins/gallery/GalleryButton.js","../../src/plugins/gallery/GalleryComponent.js","../../src/plugins/gallery/index.js"],"sourcesContent":["import { utils } from '../..';\n\n/**\n * @summary Available events\n * @enum {string}\n * @memberof PSV.plugins.GalleryPlugin\n * @constant\n */\nexport const EVENTS = {\n  /**\n   * @event show-gallery\n   * @memberof PSV.plugins.GalleryPlugin\n   * @summary Triggered when the gallery is shown\n   */\n  SHOW_GALLERY: 'show-gallery',\n  /**\n   * @event hide-gallery\n   * @memberof PSV.plugins.GalleryPlugin\n   * @summary Triggered when the gallery is hidden\n   */\n  HIDE_GALLERY: 'hide-gallery',\n};\n\nexport const GALLERY_ITEM_DATA = 'psvGalleryItem';\nexport const GALLERY_ITEM_DATA_KEY = utils.dasherize(GALLERY_ITEM_DATA);\n\nexport const ITEMS_TEMPLATE = (items, dataKey) => `\n<div class=\"psv-gallery-container\">\n  ${items.map(item => `\n  <div class=\"psv-gallery-item\" data-${dataKey}=\"${item.id}\">\n    ${item.name ? `<div class=\"psv-gallery-item-title\"><span>${item.name}</span></div>` : ''}\n    <svg class=\"psv-gallery-item-thumb\" viewBox=\"0 0 200 100\"><use href=\"#psvGalleryBlankIcon\"></use></svg>\n    ${item.thumbnail ? `<div class=\"psv-gallery-item-thumb\" data-src=\"${item.thumbnail}\"></div>` : ''}\n  </div>\n  `).join('')}\n</div>\n`;\n","import { AbstractButton } from '../..';\nimport { EVENTS } from './constants';\nimport gallery from './gallery.svg';\n\n/**\n * @summary Navigation bar gallery button class\n * @extends PSV.buttons.AbstractButton\n * @memberof PSV.buttons\n */\nexport class GalleryButton extends AbstractButton {\n\n  static id = 'gallery';\n  static icon = gallery;\n\n  /**\n   * @param {PSV.components.Navbar} navbar\n   */\n  constructor(navbar) {\n    super(navbar, 'psv-button--hover-scale psv-gallery-button', true);\n\n    /**\n     * @type {PSV.plugins.GalleryPlugin}\n     * @readonly\n     * @private\n     */\n    this.plugin = this.psv.getPlugin('gallery');\n\n    if (this.plugin) {\n      this.plugin.on(EVENTS.SHOW_GALLERY, this);\n      this.plugin.on(EVENTS.HIDE_GALLERY, this);\n    }\n  }\n\n  /**\n   * @override\n   */\n  destroy() {\n    if (this.plugin) {\n      this.plugin.off(EVENTS.SHOW_GALLERY, this);\n      this.plugin.off(EVENTS.HIDE_GALLERY, this);\n    }\n\n    delete this.plugin;\n\n    super.destroy();\n  }\n\n  /**\n   * @summary Handles events\n   * @param {Event} e\n   * @private\n   */\n  handleEvent(e) {\n    if (e.type === EVENTS.SHOW_GALLERY) {\n      this.toggleActive(true);\n    }\n    else if (e.type === EVENTS.HIDE_GALLERY) {\n      this.toggleActive(false);\n    }\n  }\n\n  /**\n   * @override\n   */\n  isSupported() {\n    return !!this.plugin;\n  }\n\n  /**\n   * @override\n   * @description Toggles gallery\n   */\n  onClick() {\n    this.plugin.toggle();\n  }\n\n}\n","import { AbstractComponent, SYSTEM, utils } from '../..';\nimport blankIcon from './blank.svg';\nimport { GALLERY_ITEM_DATA, GALLERY_ITEM_DATA_KEY, ITEMS_TEMPLATE } from './constants';\n\nconst ACTIVE_CLASS = 'psv-gallery-item--active';\n\n/**\n * @private\n */\nexport class GalleryComponent extends AbstractComponent {\n\n  constructor(plugin) {\n    super(plugin.psv, 'psv-gallery psv--capture-event');\n\n    /**\n     * @type {SVGElement}\n     * @private\n     * @readonly\n     */\n    this.blankIcon = (() => {\n      const temp = document.createElement('div');\n      temp.innerHTML = blankIcon;\n      return temp.firstChild;\n    })();\n    this.blankIcon.style.display = 'none';\n    this.psv.container.appendChild(this.blankIcon);\n\n    if ('IntersectionObserver' in window) {\n      /**\n       * @type {IntersectionObserver}\n       * @private\n       * @readonly\n       */\n      this.observer = new IntersectionObserver((entries) => {\n        entries.forEach((entry) => {\n          if (entry.intersectionRatio > 0) {\n            entry.target.style.backgroundImage = `url(${entry.target.dataset.src})`;\n            delete entry.target.dataset.src;\n            this.observer.unobserve(entry.target);\n          }\n        });\n      }, {\n        root: this.psv.container,\n      });\n    }\n\n    /**\n     * @type {PSV.plugins.GalleryPlugin}\n     * @private\n     * @readonly\n     */\n    this.plugin = plugin;\n\n    /**\n     * @type {Object}\n     * @private\n     */\n    this.prop = {\n      ...this.prop,\n      mousedown : false,\n      initMouseX: null,\n      mouseX    : null,\n    };\n\n    this.container.addEventListener(SYSTEM.mouseWheelEvent, this);\n    this.container.addEventListener('mousedown', this);\n    this.container.addEventListener('mousemove', this);\n    this.container.addEventListener('click', this);\n    window.addEventListener('mouseup', this);\n\n    this.hide();\n  }\n\n  /**\n   * @override\n   */\n  destroy() {\n    this.psv.container.removeChild(this.blankIcon);\n\n    window.removeEventListener('mouseup', this);\n\n    this.observer?.disconnect();\n\n    delete this.plugin;\n    delete this.blankIcon;\n    delete this.observer;\n\n    super.destroy();\n  }\n\n  /**\n   * @private\n   */\n  handleEvent(e) {\n    /* eslint-disable */\n    switch (e.type) {\n      case SYSTEM.mouseWheelEvent:\n        const spinY = utils.normalizeWheel(e).spinY;\n        this.container.scrollLeft += spinY * 50;\n        e.preventDefault();\n        break;\n\n      case 'mousedown':\n        this.prop.mousedown = true;\n        this.prop.initMouseX = e.clientX;\n        this.prop.mouseX = e.clientX;\n        break;\n\n      case 'mousemove':\n        if (this.prop.mousedown) {\n          const delta = this.prop.mouseX - e.clientX;\n          this.container.scrollLeft += delta;\n          this.prop.mouseX = e.clientX;\n        }\n        break;\n\n      case 'mouseup':\n        this.prop.mousedown = false;\n        this.prop.mouseX = null;\n        e.preventDefault();\n        break;\n\n      case 'click':\n        // prevent click on drag\n        if (Math.abs(this.prop.initMouseX - e.clientX) < 10) {\n          const item = utils.getClosest(e.target, `[data-${GALLERY_ITEM_DATA_KEY}]`);\n          if (item) {\n            this.plugin.__click(item.dataset[GALLERY_ITEM_DATA]);\n          }\n        }\n        break;\n    }\n    /* eslint-enable */\n  }\n\n  /**\n   * @override\n   */\n  show() {\n    this.container.classList.add('psv-gallery--open');\n    this.prop.visible = true;\n  }\n\n  /**\n   * @override\n   */\n  hide() {\n    this.container.classList.remove('psv-gallery--open');\n    this.prop.visible = false;\n  }\n\n  /**\n   * @summary Sets the list of items\n   * @param {PSV.plugins.GalleryPlugin.Item[]} items\n   */\n  setItems(items) {\n    this.container.innerHTML = ITEMS_TEMPLATE(items, GALLERY_ITEM_DATA_KEY);\n\n    if (this.observer) {\n      this.observer.disconnect();\n\n      for (const child of this.container.querySelectorAll('[data-src]')) {\n        this.observer.observe(child);\n      }\n    }\n  }\n\n  /**\n   * @param {number | string} id\n   */\n  setActive(id) {\n    const currentActive = this.container.querySelector('.' + ACTIVE_CLASS);\n    currentActive?.classList.remove(ACTIVE_CLASS);\n\n    if (id) {\n      const nextActive = this.container.querySelector(`[data-${GALLERY_ITEM_DATA_KEY}=\"${id}\"]`);\n      nextActive?.classList.add(ACTIVE_CLASS);\n    }\n  }\n\n}\n","import { AbstractPlugin, CONSTANTS, DEFAULTS, PSVError, registerButton, utils } from '../..';\nimport { EVENTS } from './constants';\nimport { GalleryButton } from './GalleryButton';\nimport { GalleryComponent } from './GalleryComponent';\nimport './style.scss';\n\n/**\n * @typedef {Object} PSV.plugins.GalleryPlugin.Item\n * @property {number|string} id - Unique identifier of the item\n * @property {*} panorama\n * @property {string} [thumbnail] - URL of the thumbnail\n * @property {string} [name] - Text visible over the thumbnail\n * @property {PSV.PanoramaOptions} [options] - Any option supported by the `setPanorama()` method\n */\n\n/**\n * @typedef {Object} PSV.plugins.GalleryPlugin.Options\n * @property {PSV.plugins.GalleryPlugin.Item[]} [items]\n * @property {boolean} [visibleOnLoad=false] - Displays the gallery when loading the first panorama\n */\n\n\n// add gallery button\nDEFAULTS.lang[GalleryButton.id] = 'Gallery';\nregisterButton(GalleryButton, 'caption:left');\n\n\nexport { EVENTS } from './constants';\n\n\n/**\n * @summary Adds a gallery of multiple panoramas\n * @extends PSV.plugins.AbstractPlugin\n * @memberof PSV.plugins\n */\nexport class GalleryPlugin extends AbstractPlugin {\n\n  static id = 'gallery';\n\n  static EVENTS = EVENTS;\n\n  /**\n   * @param {PSV.Viewer} psv\n   * @param {PSV.plugins.GalleryPlugin.Options} options\n   */\n  constructor(psv, options) {\n    super(psv);\n\n    /**\n     * @member {PSV.plugins.GalleryPlugin.Options}\n     * @private\n     */\n    this.config = {\n      items        : null,\n      visibleOnLoad: false,\n      ...options,\n    };\n\n    /**\n     * @type {Object}\n     * @private\n     */\n    this.prop = {\n      handler  : null,\n      currentId: null,\n    };\n\n    /**\n     * @type {GalleryComponent}\n     * @private\n     * @readonly\n     */\n    this.gallery = new GalleryComponent(this);\n\n    /**\n     * @type {PSV.plugins.GalleryPlugin.Item[]}\n     * @private\n     */\n    this.items = [];\n  }\n\n  /**\n   * @package\n   */\n  init() {\n    super.init();\n\n    this.psv.on(CONSTANTS.EVENTS.PANORAMA_LOADED, this);\n\n    if (this.config.visibleOnLoad) {\n      this.psv.once(CONSTANTS.EVENTS.READY, () => {\n        this.show();\n      });\n    }\n\n    this.setItems(this.config.items);\n    delete this.config.items;\n  }\n\n  /**\n   * @package\n   */\n  destroy() {\n    this.psv.off(CONSTANTS.EVENTS.PANORAMA_LOADED, this);\n\n    this.gallery.destroy();\n\n    super.destroy();\n  }\n\n  /**\n   * @private\n   */\n  handleEvent(e) {\n    /* eslint-disable */\n    switch (e.type) {\n      case CONSTANTS.EVENTS.PANORAMA_LOADED:\n        const item = this.items.find(i => utils.deepEqual(i.panorama, e.args[0].panorama));\n        this.prop.currentId = item?.id;\n        this.gallery.setActive(item?.id);\n        break;\n    }\n    /* eslint-enable */\n  }\n\n  /**\n   * @summary Shows the gallery\n   * @fires PSV.plugins.GalleryPlugin.show-gallery\n   */\n  show() {\n    this.trigger(EVENTS.SHOW_GALLERY);\n    return this.gallery.show();\n  }\n\n  /**\n   * @summary Hides the carousem\n   * @fires PSV.plugins.GalleryPlugin.hide-gallery\n   */\n  hide() {\n    this.trigger(EVENTS.HIDE_GALLERY);\n    return this.gallery.hide();\n  }\n\n  /**\n   * @summary Hides or shows the gallery\n   */\n  toggle() {\n    return this.gallery.toggle();\n  }\n\n  /**\n   * @summary Sets the list of items\n   * @param {PSV.plugins.GalleryPlugin.Item[]} items\n   * @param {function} [handler] function that will be called when an item is clicked instead of the default behavior\n   */\n  setItems(items, handler) {\n    if (!items?.length) {\n      items = [];\n    }\n    else {\n      items.forEach((item, i) => {\n        if (!item.id) {\n          throw new PSVError(`Item ${i} has no \"id\".`);\n        }\n        if (!item.panorama) {\n          throw new PSVError(`Item ${item.id} has no \"panorama\".`);\n        }\n      });\n    }\n\n    this.prop.handler = handler;\n    this.items = items.map(item => ({\n      ...item,\n      id: `${item.id}`,\n    }));\n\n    this.gallery.setItems(items);\n  }\n\n  /**\n   * @param {string} id\n   * @package\n   */\n  __click(id) {\n    if (id === this.prop.currentId) {\n      return;\n    }\n\n    if (this.prop.handler) {\n      this.prop.handler(id);\n    }\n    else {\n      const item = this.items.find(i => i.id === id);\n      this.psv.setPanorama(item.panorama, {\n        caption: item.name,\n        ...item.options,\n      });\n    }\n\n    this.prop.currentId = id;\n    this.gallery.setActive(id);\n  }\n\n}\n"],"names":["EVENTS","SHOW_GALLERY","HIDE_GALLERY","GALLERY_ITEM_DATA","GALLERY_ITEM_DATA_KEY","utils","dasherize","ITEMS_TEMPLATE","items","dataKey","map","item","id","name","thumbnail","join","GalleryButton","navbar","plugin","psv","getPlugin","on","destroy","off","handleEvent","e","type","toggleActive","isSupported","onClick","toggle","AbstractButton","icon","gallery","ACTIVE_CLASS","GalleryComponent","blankIcon","temp","document","createElement","innerHTML","firstChild","style","display","container","appendChild","window","observer","IntersectionObserver","entries","forEach","entry","intersectionRatio","target","backgroundImage","dataset","src","unobserve","root","prop","mousedown","initMouseX","mouseX","addEventListener","SYSTEM","mouseWheelEvent","hide","removeChild","removeEventListener","disconnect","spinY","normalizeWheel","scrollLeft","preventDefault","clientX","delta","Math","abs","getClosest","__click","show","classList","add","visible","remove","setItems","querySelectorAll","child","observe","setActive","currentActive","querySelector","nextActive","AbstractComponent","DEFAULTS","lang","registerButton","GalleryPlugin","options","config","visibleOnLoad","handler","currentId","init","CONSTANTS","PANORAMA_LOADED","once","READY","find","i","deepEqual","panorama","args","trigger","length","PSVError","setPanorama","caption","AbstractPlugin"],"mappings":"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"}